<div class="container">
    <div class="admin-header">
        <div class="container">
            <h1>管理后台</h1>
            <nav class="admin-nav">
                <a href="/blog/admin/">仪表盘</a>
                <a href="/blog/admin/new">新建文章</a>
                <a href="/blog/">返回前台</a>
            </nav>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card primary">
            <h3>{{total_articles}}</h3>
            <p>文章总数</p>
        </div>
        <div class="stat-card success">
            <h3>{{published_articles}}</h3>
            <p>已发布</p>
        </div>
        <div class="stat-card warning">
            <h3>{{draft_articles}}</h3>
            <p>草稿</p>
        </div>
        <div class="stat-card danger">
            <h3>{{total_comments}}</h3>
            <p>评论总数</p>
        </div>
    </div>

    <div class="admin-panel">
        <div class="panel-header">
            <h2>文章管理</h2>
            <a href="/blog/admin/new" class="btn btn-success">新建文章</a>
        </div>
        <div class="panel-content">
            {{#if has_articles}}
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>标题</th>
                        <th>状态</th>
                        <th>分类</th>
                        <th>创建时间</th>
                        <th>浏览量</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each articles}}
                    <tr>
                        <td>{{article_id}}</td>
                        <td>{{title}}</td>
                        <td>
                            <span class="status status-{{status}}">{{status}}</span>
                        </td>
                        <td>{{category_name}}</td>
                        <td>{{created_at}}</td>
                        <td>{{view_count}}</td>
                        <td class="actions">
                            <a href="/blog/admin/edit/{{article_id}}" class="btn btn-sm">编辑</a>
                            <a href="/blog/article/{{article_id}}" class="btn btn-sm btn-secondary">查看</a>
                            <button class="btn btn-sm btn-danger" onclick="deleteArticle({{article_id}})">删除</button>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
            {{/if}}
            
            {{#if no_articles}}
            <div class="no-content">
                <h3>暂无文章</h3>
                <p><a href="/blog/admin/new" class="btn btn-success">创建第一篇文章</a></p>
            </div>
            {{/if}}
        </div>
    </div>
</div>

<script>
function deleteArticle(articleId) {
    if (confirm('确定要删除这篇文章吗？此操作不可恢复。')) {
        fetch('/blog/api/articles/' + articleId, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('删除失败：' + (data.message || '未知错误'));
            }
        })
        .catch(error => {
            alert('删除失败：网络错误');
        });
    }
}
</script>